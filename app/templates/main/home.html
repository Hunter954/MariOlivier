{% extends "layout.html" %}
{% from "_macros.html" import sidebar, topbar, card_episode, card_season %}
{% set title = "Home • Mari-Olivier" %}
{% block body %}
<div class="app-shell">
  {{ sidebar("home", user) }}
  <main class="main">
    {{ topbar(user) }}

    <section class="grid">
      <div class="col-left">
        <h2 class="section-title">Temporada atual</h2>
        <div class="hero card big">
          <div class="hero-story">
            <div class="hero-cover">
              {% if current_season and current_season.thumbnail_url %}
                <div class="hero-thumb" style="background-image:url('{{ current_season.thumbnail_url }}')"></div>
              {% else %}
                <div class="hero-thumb"></div>
              {% endif %}
              <div class="hero-overlay"></div>
            </div>

            {% if continue_episode %}
            <div class="continue">
              <div class="kicker">Continue Assistindo</div>
              <div class="h1">Temporada {{ continue_episode.season.number }} • Episódio {{ continue_episode.episode_number }}</div>
              <div class="sub">Episódio {{ continue_episode.episode_number }}: {{ continue_episode.title }}{% if continue_episode.duration_minutes %} - {{ continue_episode.duration_minutes }}min{% endif %}</div>
              <div class="row">
                <a class="btn primary" href="{{ url_for('main.assistir', episode_id=continue_episode.id) }}">Retomar</a>
                <a class="btn" href="{{ url_for('main.temporada_detail', season_id=continue_episode.season.id) }}">Recomeçar</a>
              </div>
            </div>
            {% else %}
            <div class="continue">
              <div class="kicker">Sem episódios ainda</div>
              <div class="h1">Cadastre episódios no Admin</div>
              <div class="sub">Defina temporadas, thumbnails e links do YouTube.</div>
            </div>
            {% endif %}
          </div>
        </div>
      </div>

      <div class="col-right">
        <h2 class="section-title">Próximos Episódios</h2>
        <div class="row-cards">
          {% for ep in upcoming_eps %}
            {{ card_episode(ep, small=True) }}
          {% endfor %}
          {% if upcoming_eps|length == 0 %}
            <div class="muted">Nenhum episódio próximo.</div>
          {% endif %}
        </div>

        <div class="row between align">
          <h2 class="section-title" style="margin-top:28px;">Próximas temporadas</h2>
          <a class="link" href="{{ url_for('main.temporadas') }}">Ver todas...</a>
        </div>

        <div class="row-seasons">
          {% for s in next_seasons %}
            {{ card_season(s) }}
          {% endfor %}
        </div>
      </div>
    </section>
  </main>
</div>
{% endblock %}
